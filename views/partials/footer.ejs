    </main>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <h5><%= t.siteName %></h5>
                    <p><%= t.footer.slogan %></p>
                </div>
                <div class="col-md-4">
                    <h5><%= t.contact %></h5>
                    <p><%= lang === 'en' ? 'Tel' : '电话' %>: <%= siteConfig.phone %></p>
                    <p><%= lang === 'en' ? 'Email' : '邮箱' %>: <%= siteConfig.email %></p>
                    <% if (siteConfig.whatsapp) { %>
                    <p>WhatsApp: <a class="text-white" href="https://wa.me/<%= siteConfig.whatsapp.replace('+','') %>" target="_blank"><%= siteConfig.whatsapp %></a></p>
                    <% } %>
                </div>
                <div class="col-md-4">
                    <h5><%= t.footer.links %></h5>
                    <ul class="list-unstyled">
                        <li><a href="/products" class="text-white-50"><%= t.products %></a></li>
                        <li><a href="/about" class="text-white-50"><%= t.about %></a></li>
                    </ul>
                </div>
            </div>
            <div class="text-center mt-3 pt-3 border-top border-secondary">
                <p class="mb-0">&copy; 2023 <%= t.siteName %>. <%= t.footer.rights %></p>
            </div>
        </div>
    </footer>

    <div id="chatWidget" class="position-fixed" style="right:20px; bottom:20px; z-index:1050;">
        <button class="btn btn-success rounded-circle shadow" style="width:56px; height:56px;" data-bs-toggle="modal" data-bs-target="#chatModal">
            <i class="fas fa-comments"></i>
        </button>
    </div>
    <% if (siteConfig.whatsapp) { %>
    <div id="whatsappWidget" class="position-fixed" style="right:90px; bottom:20px; z-index:1050;">
        <a href="https://wa.me/<%= siteConfig.whatsapp.replace('+','') %>" target="_blank" class="btn btn-success rounded-circle shadow" style="width:56px; height:56px;" title="<%= t.contactViaWhatsApp %>">
            <i class="fab fa-whatsapp"></i>
        </a>
    </div>
    <% } %>

    <div class="modal fade" id="chatModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-end">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">在线咨询</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div id="chatStartForm">
                <div class="mb-2">
                    <label class="form-label">公司名称</label>
                    <input type="text" id="chatCompany" class="form-control" required>
                </div>
                <div class="mb-2">
                    <label class="form-label">感兴趣的产品</label>
                    <input type="text" id="chatProduct" class="form-control">
                </div>
                <div class="mb-2">
                    <label class="form-label">电话</label>
                    <input type="text" id="chatPhone" class="form-control">
                </div>
                <div class="mb-2">
                    <label class="form-label">邮箱</label>
                    <input type="email" id="chatEmail" class="form-control">
                </div>
                <button class="btn btn-primary w-100" id="chatStartBtn">开始聊天</button>
            </div>
            <div id="chatBox" class="d-none">
                <div id="chatMessages" class="border rounded p-2" style="height:300px; overflow-y:auto;"></div>
                <div class="d-flex mt-2">
                    <input type="text" id="chatInput" class="form-control me-2" placeholder="输入消息">
                    <button class="btn btn-primary" id="chatSendBtn">发送</button>
                </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
    (() => {
        const startForm = document.getElementById('chatStartForm');
        const chatBox = document.getElementById('chatBox');
        const startBtn = document.getElementById('chatStartBtn');
        const sendBtn = document.getElementById('chatSendBtn');
        const messagesEl = document.getElementById('chatMessages');
        const inputEl = document.getElementById('chatInput');
        let pollTimer = null;

        function addMsg(sender, content) {
            const wrap = document.createElement('div');
            wrap.className = 'd-flex mb-2 ' + (sender === 'visitor' ? 'justify-content-end' : 'justify-content-start');
            const bubble = document.createElement('div');
            bubble.className = 'p-2 rounded ' + (sender === 'visitor' ? 'bg-primary text-white' : 'bg-light');
            bubble.textContent = content;
            wrap.appendChild(bubble);
            messagesEl.appendChild(wrap);
            messagesEl.scrollTop = messagesEl.scrollHeight;
        }

        async function loadMessages() {
            try {
                const r = await fetch('/chat/messages');
                const data = await r.json();
                messagesEl.innerHTML = '';
                (data.messages || []).forEach(m => addMsg(m.sender, m.content));
            } catch (e) {}
        }

        startBtn?.addEventListener('click', async () => {
            const company = document.getElementById('chatCompany').value.trim();
            const interested_product = document.getElementById('chatProduct').value.trim();
            const phone = document.getElementById('chatPhone').value.trim();
            const email = document.getElementById('chatEmail').value.trim();
            if (!company) return;
            const r = await fetch('/chat/start', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ company, interested_product, phone, email })
            });
            const data = await r.json();
            if (data.ok) {
                startForm.classList.add('d-none');
                chatBox.classList.remove('d-none');
                await loadMessages();
                pollTimer = setInterval(loadMessages, 2000);
            }
        });

        sendBtn?.addEventListener('click', async () => {
            const content = inputEl.value.trim();
            if (!content) return;
            const r = await fetch('/chat/message', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ content })
            });
            const data = await r.json();
            if (data.ok) {
                inputEl.value = '';
                await loadMessages();
            }
        });
    })();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
