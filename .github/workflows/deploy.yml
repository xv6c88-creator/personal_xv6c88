# 工作流的名称
name: Deploy EJS to GitHub Pages

# 1. 触发条件：当代码推送到 main 分支时触发
on:
  push:
    branches: [main] 

# 2. 定义任务
jobs:
  deploy:
    # 运行环境：最新的 Ubuntu 系统
    runs-on: ubuntu-latest 

    steps:
      # 第一步：拉取你仓库里的代码 (包含你的 EJS 源码)
      - name: Checkout code
        uses: actions/checkout@v4

      # 第二步：配置 Node.js 环境
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20' # 指定 Node.js 版本

      # 第三步：安装项目依赖 (就是安装 ejs)
      - name: Install dependencies
        run: npm install

      # 第四步：执行构建 (关键！这一步会生成 HTML 文件)
      # 这里假设你的 build 脚本会生成一个名为 'dist' 的文件夹
      - name: Build Site
        run: npm run build
        # 注意：如果构建失败，后面的步骤不会执行

      # 第五步：部署到 GitHub Pages
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          # 这里填写你构建生成的文件夹名称
          # 比如你的 HTML 文件都在 dist 文件夹里，就写 dist
          # 如果在 public 文件夹里，就写 public
          github_token: ${{ secrets.GITHUB_TOKEN }} 
          publish_dir: ./dist # ⬅️ 这里改成你生成的文件夹名

  
   


permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: true


  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '18'
      - run: npm ci || npm install
      - run: npm run build
      - uses: actions/upload-pages-artifact@v3
        with:
          path: ./dist

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - id: deployment
        uses: actions/deploy-pages@v4

